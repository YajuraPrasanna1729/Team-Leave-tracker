<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Leave Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f6f6f6; margin: 0; padding: 20px; color: #333; }
    header { max-width: 900px; margin: 0 auto 20px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    h1 { margin: 0; font-size: 1.5rem; }
    .controls { display: flex; gap: 8px; align-items: center; }
    input[type=date] { padding: 6px 10px; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: 6px 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; }
    #showing { text-align: center; color: #555; margin: 12px auto; max-width: 900px; }
    #cards { max-width: 900px; margin: 0 auto; display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); cursor: pointer; transition: transform .15s; }
    .card:hover { transform: translateY(-3px); }
    .card strong { display: block; margin-bottom: 8px; color: #0066cc; }
    .details { display: none; margin-top: 10px; color: #555; font-size: .9rem; background: #f9f9f9; padding: 8px; border-radius: 6px; }
    .card.active .details { display: block; }
    .warning { color: #a33; text-align: center; margin-top: 10px; }
  </style>
</head>
<body>

<header>
  <h1>Leave Tracker</h1>
  <div class="controls">
    <input type="date" id="datePicker">
    <button id="clearBtn">Clear</button>
  </div>
</header>

<div id="showing">Loading...</div>
<div id="cards"></div>
<div id="msg" class="warning"></div>

<script>
  // --- CONFIG: replace with your sheet export URL ---
  const sheetURL = "https://docs.google.com/spreadsheets/d/1k7XSPXOzPdNDf-l0k-rtawf49X6yJ5lapIBofXnPu5s/export?format=csv&gid=0";
  // ----------------------------------------------------

  const datePicker = document.getElementById('datePicker');
  const clearBtn = document.getElementById('clearBtn');
  const cardsDiv = document.getElementById('cards');
  const showingDiv = document.getElementById('showing');
  const msgDiv = document.getElementById('msg');

  let allEntries = [];

  // Clear date => show all
  clearBtn.addEventListener('click', () => {
    datePicker.value = "";
    render();
  });

  // On date change
  datePicker.addEventListener('input', render);

  // Fetch sheet data
  fetch(sheetURL)
    .then(r => {
      if (!r.ok) throw new Error('Fetch error: ' + r.status);
      return r.text();
    })
    .then(text => {
      const rows = text.trim().split('\n').map(r => r.split(',').map(c => c.trim()));
      const headers = rows.shift();
      allEntries = rows.map(r => {
        const obj = {};
        headers.forEach((h,i) => obj[h] = r[i] || "");
        return obj;
      });
      render();
    })
    .catch(err => {
      showingDiv.textContent = "Error loading data.";
      msgDiv.textContent = err.message;
      console.error(err);
    });

  function render() {
    const selDateStr = datePicker.value;
    const selDate = selDateStr ? new Date(selDateStr + 'T00:00:00') : null;
    showingDiv.textContent = selDate ? `Showing for ${formatDisplay(selDate)}` : 'Showing all entries';

    cardsDiv.innerHTML = '';
    msgDiv.textContent = '';

    let visible = 0;
    allEntries.forEach(entry => {
      const fromDate = parseDate(entry.From);
      const toDate   = parseDate(entry.To);
      if (!fromDate || !toDate) return;

      let ok = true;
      if (selDate) {
        ok = (selDate >= fromDate && selDate <= toDate);
      }
      if (ok) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <strong>${entry.Name || 'Unknown'}</strong>
          <div>Team: ${entry.Team || ''}</div>
          <div class="details">
            <div><b>From:</b> ${entry.From}</div>
            <div><b>To:</b> ${entry.To}</div>
            <div><b>Comments:</b> ${entry.Comments || ''}</div>
          </div>
        `;
        card.addEventListener('click', () => {
          document.querySelectorAll('.card.active').forEach(c => { if (c !== card) c.classList.remove('active'); });
          card.classList.toggle('active');
        });
        cardsDiv.appendChild(card);
        visible++;
      }
    });

    if (visible === 0) {
      cardsDiv.innerHTML = '<p style="text-align:center;color:#777">No matching entries.</p>';
    }
  }

  function parseDate(str) {
    if (!str) return null;
    str = str.trim().replace(/\r|\n/g, '');
    const parts = str.split(/[-\/]/);
    if (parts.length < 3) return null;
    let [d,m,y] = parts;
    d = Number(d); m = Number(m);
    if (y.length === 2) y = '20'+y;
    y = Number(y);
    if (isNaN(d)||isNaN(m)||isNaN(y)) return null;
    return new Date(y, m-1, d);
  }

  function formatDisplay(date) {
    return date.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
  }

</script>

</body>
</html>
